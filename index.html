<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <title>API Control</title>
</head>

<body>
  <h1 style="font-family:Arial, Helvetica, sans-serif;font-size: 30px;text-align: center;">Control Forestal - Los LLeuques </h1>

  <ul id="despachos-list"></ul>

  <div class="container">
    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Últimos Despachos</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Guia</th>
            <th scope="col">Fecha</th>
            <th scope="col">Destino</th>
            <th scope="col">Metros</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">119</th>
            <td>2023-10-10</td>
            <td>Km 10</td>
            <td>33.428</td>
          </tr>
          <tr>
            <th scope="row">118</th>
            <td>2023-10-10</td>
            <td>Km 10</td>
            <td>37.723</td>
          </tr>
          <tr>
            <th scope="row">117</th>
            <td>2023-10-10</td>
            <td>Km 10</td>
            <td>39,391</td>
          </tr>
        </tbody>
      </table>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

    <div class="row">
      <div class="col">
        <canvas id="myChart"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD"></canvas>
        </div>
      </div>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

    <div class="row">
      <div class="col">
        <canvas id="myChart2"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD2"></canvas>
        </div>
      </div>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

    <div class="row">
      <div class="col">
        <canvas id="myChart3"></canvas>
      </div>
      <div class="col">
        <canvas id="myChart5"></canvas>
      </div>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

    <div class="row">
      <div class="col">
        <canvas id="myChart4"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD3"></canvas>
        </div>
      </div>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const ctx = document.getElementById('myChart');
    Chart.defaults.font.size = 16;

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
        datasets: [{
          label: 'Metros Despachados esta Semana',
          data: [0, 110.542, 0, 0, 0, 0, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        },
        plugins: {
          legend: {
            labels: {
              // This more specific font property overrides the global property
              font: {
                //size: 26
              }
            }
          }
        }
      }
    });
  </script>


  <script>
    const ctx2 = document.getElementById('myChart2');


    new Chart(ctx2, {
      type: 'bar',

      data: {
        labels: ['MR', '2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0+'],
        datasets: [{
          label: 'Metros Despachados este Mes',
          data: [0, 0, 111.4, 136.53, 0, 198.61, 34.31, 30, 76, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 38
            }
          }
        }
      }
    });
  </script>
  <script>
    const ctx5 = document.getElementById('myChart5');

    new Chart(ctx5, {
      type: 'bar',

      data: {
        labels: ['24', '26', '28', '30', '32', '34', '36', '38', '40', '42'],
        datasets: [{
          label: 'Esquema de Trozado 3.3 Grueso',
          data: [4, 1, 10, 12, 6, 5, 8, 11, 21, 22],
          borderWidth: 1,
          backgroundColor: '#38C22590'
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>

  <script>
    const ctx3 = document.getElementById('myChart3');

    new Chart(ctx3, {
      type: 'bar',

      data: {
        labels: ['3.3 D', '3.3 G', '4.0', '6.0', '7.0', '8.0', 'Pulpa', 'Aserrable'],
        datasets: [{
          label: 'Producción Los LLeuques',
          data: [111.8, 98.8, 66.3, 49.2, 34.3, 30.8, 63.8, 151.1],
          borderWidth: 1,
          backgroundColor: '#F1624490'
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>
  <script>
    const ctx4 = document.getElementById('myChart4');

    new Chart(ctx4, {
      type: 'bar',

      data: {
        labels: ['MR', '2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0+'],
        datasets: [{
          label: 'Total Despachos Los Lleuques',
          data: [295.03, 101.29, 806.45, 1183.6, 300.8, 1156.99, 34.31, 30.76, 34.59],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>

  <script>
    var ctx6 = document.getElementById("myChartD");
    var myChart = new Chart(ctx6, {
      type: 'pie',
      data: {
        labels: ['KM 10', 'COLPO'],
        datasets: [{
          label: 'Metros Despachados',
          data: [71.151, 39.391],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)'
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        //cutoutPercentage: 40,
        responsive: false,

      }
    });
  </script>
  <script>
    var ctx7 = document.getElementById("myChartD2");
    var myChart = new Chart(ctx7, {
      type: 'pie',
      data: {
        labels: ['KM 10', 'COLPO', 'RF Lumber'],
        datasets: [{
          label: 'Metros Despachados',
          data: [178.27, 227.85, 105.50],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',

          ],
          borderWidth: 1
        }]
      },
      options: {
        //cutoutPercentage: 40,
        responsive: false,

      }
    });
  </script>
  <script>
    var ctx8 = document.getElementById("myChartD3");
    var myChart = new Chart(ctx8, {
      type: 'pie',
      data: {
        labels: ['KM 10', 'COLPO', 'RF Lumber', 'Aravena', 'Cherquenco'],
        datasets: [{
          label: 'Metros Despachados',
          data: [1839.56, 1703.85, 105.50, 251.5, 43.53],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(0, 99, 132, 0.5)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(0, 99, 132, 1)',

          ],
          borderWidth: 1
        }]
      },
      options: {
        //cutoutPercentage: 40,
        responsive: false,

      }
    });
  </script>

  <script>
    // Function to fetch and display data from the API



    async function fetchData() {
      const apiURL = 'http://controlforestal.pablocanales.info/api/despachos?token=dq02SQSq4oruM7SedTgwb4rEB7Bp9QZ4';

      try {
        const response = await fetch(apiURL);
        const data = await response.json();

        var date = new Date();

        if (response.ok) {
          const despachosList = document.getElementById('despachos-list');
          let contador_0 = 0;
          let contador_m3 = 0;

          //                     switch(date.getDay()){

          //   case 0: alert("domingo!"); break;

          //   case 1: alert("lunes!"); break;
          //   case 2: alert("martes!"); break;
          //   case 3: alert("miercoles!"); break;
          //   case 4: alert("jueves!"); break;
          //   case 5: alert("viernes!"); break;
          //     case 6: alert("sabado!"); break;
          //     default: alert("any other week day");
          // }

          let first_day_of_the_week = new Date(date_today.setDate(date_today.getDate()
            - date_today.getDay() + 1));
          console.log(`The first date of the week is: ${first_day_of_the_week}`);


          let last_day_of_the_week = new Date(date_today.setDate(date_today.getDate()
            - date_today.getDay() + 7));

          let cont_lunes = 0;
          let cont_martes = 0;
          let cont_miercoles = 0;
          let cont_jueves = 0;
          let cont_viernes = 0;
          let cont_sabado = 0;
          let cont_domingo = 0;
          data.forEach((despacho) => {
            let fecha = new Date(despacho.fecha_ingreso)
            //console.log('hola '+fecha)
            console.log('hola' + fecha.getDay())
            console.log(`The first date of the week is: ${first_day_of_the_week}`);
            if (despacho.metros_duros == 0) {
              contador_0 = contador_0 + 1
            }
            /*else{
              const listItem = document.createElement('li');
              switch(fecha.getDay()){
              case 1: diasemana="Lunes";
              if ((fecha >= first_day_of_the_week)&&(fecha <= last_day_of_the_week)){
                cont_lunes=cont_lunes+despacho.metros_duros;
                //console.log(cont_lunes);
                
              }   
                              
              break;
              case 2: diasemana="Martes"; break;
              case 3: diasemana="Miercoles"; break;
              case 4: diasemana="Jueves"; break;
              case 5: diasemana="Viernes"; break;
              case 6: diasemana="Sabado"; break;
              case 7: diasemana="Domingo"; break;
            }
             
            
            fecha=fecha.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"});    
            listItem.textContent = `Guía: ${despacho.numero_guia_despacho}, Fecha: ${fecha} Metros: ${despacho.metros_duros}, Rodal: ${despacho.rodal}`;
            despachosList.appendChild(listItem);
                contador_m3=contador_m3 + 1} */
          })
          console.log(contador_0);
          console.log(contador_m3);
        } else {
          console.error(`Error: ${response.status} - ${data.message}`);
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // Call the fetchData function when the page loads
    window.addEventListener('load', fetchData);

    let date_today = new Date();


    console.log(`The current day index of the week is: ${date_today.getDay()}`);


    console.log(`The current date of the week is: ${date_today.getDate()}`);




//console.log(`The first date of the week is: ${first_day_of_the_week}`); 
//console.log(`The last day of the week is: ${last_day_of_the_week}`);

  </script>
</body>

</html>
