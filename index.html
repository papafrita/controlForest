<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Control</title>
</head>
<body>
    <h1>Control Forestal  </h1>
    <ul id="despachos-list"></ul>
    <div style="width:60%">
        <canvas  id="myChart"></canvas>
      </div>
      <div style="width:60%">
        <canvas  id="myChart2"></canvas>
      </div>
      <div style="width:60%">
        <canvas  id="myChart3"></canvas>
      </div>  
      <div style="width:60%">
        <canvas  id="myChart4"></canvas>
      </div>    
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
      <script>
        const ctx = document.getElementById('myChart');
      
        new Chart(ctx, {
          type: 'bar',
          
          data: {
            labels: ['Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado', 'Domingo'],
            datasets: [{
              label: 'Metros Despachados esta Semana',
              data: [0,110.542, 0, 0, 0, 0, 0],
              borderWidth: 1,
              backgroundColor:["green"]
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      </script>

      
<script>
  const ctx2 = document.getElementById('myChart2');

  new Chart(ctx2, {
    type: 'bar',
    
    data: {
      labels: ['Metro Ruma','2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0 y más'],
      datasets: [{
        label: 'Metros Despachados este Mes',
        data: [0,0, 111.4, 136.53, 0, 198.61, 34.31,30,76,0],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
<script>
  const ctx5 = document.getElementById('myChart5');

  new Chart(ctx5, {
    type: 'bar',
    
    data: {
      labels: ['3.30 Del', '3.30 Gru', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0 y más','Pulpa','Aserrable'],
      datasets: [{
        label: 'Producción Total Los Lleuques',
        data: [111.8, 98.8, 66.3, 0, 49.2, 34.3, 30.8, 0, 63.8, 151.1],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

<script>
  const ctx3 = document.getElementById('myChart3');

  new Chart(ctx3, {
    type: 'bar',
    
    data: {
      labels: ['Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado', 'Domingo'],
      datasets: [{
        label: 'Producción Semanal',
        data: [0, 30, 10, 0, 25, 10,0],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
<script>
  const ctx4 = document.getElementById('myChart4');

  new Chart(ctx4, {
    type: 'bar',
    
    data: {
      labels: ['Metro Ruma','2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0 y más'],
      datasets: [{
        label: 'Total Despachos Los Lleuques',
        data: [295.03, 101.29, 806.45, 1183.6, 300.8, 1156.99,34.31,30.76,34.59],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>


    <script>
        // Function to fetch and display data from the API

        
        
        async function fetchData() {
            const apiURL = 'http://controlforestal.pablocanales.info/api/despachos?token=dq02SQSq4oruM7SedTgwb4rEB7Bp9QZ4';

            try {
                const response = await fetch(apiURL);
                const data = await response.json();

                var date = new Date();

                if (response.ok) {
                    const despachosList = document.getElementById('despachos-list');
                    let contador_0 = 0;
                    let contador_m3=  0;

//                     switch(date.getDay()){
  
//   case 0: alert("domingo!"); break;
  
//   case 1: alert("lunes!"); break;
//   case 2: alert("martes!"); break;
//   case 3: alert("miercoles!"); break;
//   case 4: alert("jueves!"); break;
//   case 5: alert("viernes!"); break;
//     case 6: alert("sabado!"); break;
//     default: alert("any other week day");
// }

let first_day_of_the_week = new Date(date_today.setDate(date_today.getDate() 
                              - date_today.getDay() + 1));
                              console.log(`The first date of the week is: ${first_day_of_the_week}`); 


let last_day_of_the_week = new Date(date_today.setDate(date_today.getDate() 
                              - date_today.getDay() + 7));

                    let cont_lunes=0;
                    let cont_martes=0;
                    let cont_miercoles=0;
                    let cont_jueves=0;
                    let cont_viernes=0;
                    let cont_sabado=0;
                    let cont_domingo=0;
                    data.forEach((despacho) => {
                      let fecha= new Date(despacho.fecha_ingreso )
                      //console.log('hola '+fecha)
                      console.log('hola'+fecha.getDay())  
                      console.log(`The first date of the week is: ${first_day_of_the_week}`); 
                      if (despacho.metros_duros == 0) {
                        contador_0= contador_0+1}
                      else{
                        const listItem = document.createElement('li');
                        switch(fecha.getDay()){
                        case 1: diasemana="Lunes";
                        if ((fecha >= first_day_of_the_week)&&(fecha <= last_day_of_the_week)){
                          cont_lunes=cont_lunes+despacho.metros_duros;
                          //console.log(cont_lunes);
                          
                        }   
                                        
                        break;
                        case 2: diasemana="Martes"; break;
                        case 3: diasemana="Miercoles"; break;
                        case 4: diasemana="Jueves"; break;
                        case 5: diasemana="Viernes"; break;
                        case 6: diasemana="Sabado"; break;
                        case 7: diasemana="Domingo"; break;
                      }
                       
                      
                      fecha=fecha.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"});    
                      listItem.textContent = `Guía: ${despacho.numero_guia_despacho}, Fecha: ${fecha} Metros: ${despacho.metros_duros}, Rodal: ${despacho.rodal}`;
                      despachosList.appendChild(listItem);
                          contador_m3=contador_m3 + 1}
                      } )                       
                    console.log(contador_0);
                    console.log(contador_m3);
                } else {
                    console.error(`Error: ${response.status} - ${data.message}`);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Call the fetchData function when the page loads
        window.addEventListener('load', fetchData);

        let date_today = new Date();
        

console.log(`The current day index of the week is: ${date_today.getDay()}`);


console.log(`The current date of the week is: ${date_today.getDate()}`);




//console.log(`The first date of the week is: ${first_day_of_the_week}`); 
//console.log(`The last day of the week is: ${last_day_of_the_week}`);

</script>
</body>
</html>
