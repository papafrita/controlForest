  <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <title>API Control</title>

  <!-- <script src="apiscript.js"></script> -->

</head>

<body>
  <ul class="navbar">
    <li><a href="sotillo.html">Sotillo</a></li>
    <li><a href="index.html">Lleuques</a></li>
</ul>
<style>
  /* Add some basic CSS for styling the navigation bar */
  ul.navbar {
      list-style-type: none;
      margin: 0;
      padding: 0;
      background-color: #333;
  }

  ul.navbar li {
      display: inline;
  }

  ul.navbar li a {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
  }

  ul.navbar li a:hover {
      background-color: #555;
  }
</style>
  <h1 style="font-family:Arial, Helvetica, sans-serif;font-size: 30px;text-align: center;">Control Forestal - Sotillo </h1>

  <ul id="despachos-list"></ul>

  <div class="container">
    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Últimos Despachos</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Guia JAS</th>
            <th scope="col">Guia SII</th>
            <th scope="col">Fecha</th>
            <th scope="col">Destino</th>
            <th scope="col">Metros</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row" id="desp_1_1">27</th>
            <td id="desp_1_2">10015</td>
            <td id="desp_1_3">2023-10-30</td>
            <td id="desp_1_4">F. Cudico</td>
            <td id="desp_1_5">29,18</td>
          </tr>
          <tr>
            <th scope="row" id="desp_2_1">26</th>
            <td id="desp_2_2">10014</td>
            <td id="desp_2_3">2023-10-30</td>
            <td id="desp_2_4">F. Cudico</td>
            <td id="desp_2_5">22,30</td>
          </tr>
          <tr>
            <th scope="row" id="desp_3_1">25</th>
            <td id="desp_3_2">10013</td>
            <td id="desp_3_3">2023-10-26</td>
            <td id="desp_3_4">F. Cudico</td>
            <td id="desp_3_5">35,107</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div style="border: 1px solid #666666;padding-left: 1.5em;padding-right: 1.5em;border-radius: 1em;margin-bottom: 1em;">
    <div class="row">
      <div class="col">
        <canvas id="myChart"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD"></canvas>
        </div>
      </div>
      
    </div>
    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Detalle de la Semana</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">MR</th>
            <th scope="col">2,5</th>
            <th scope="col">3,2</th>
            <th scope="col">4</th>
            <th scope="col">5</th>
            <th scope="col">6</th>
            <th scope="col">7</th>
            <th scope="col">8</th>
            <th scope="col">9+</th>
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <th scope="row">0</th>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
    <div style="border: 1px solid #666666;padding-left: 1.5em;padding-right: 1.5em;border-radius: 1em;margin-bottom: 1em;">
    <div class="row">
      <div class="col">
        <canvas id="myChart2"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD2"></canvas>
        </div>
      </div>
    </div>
    

    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Detalle del Mes</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">MR</th>
            <th scope="col">2,5</th>
            <th scope="col">3,2</th>
            <th scope="col">4</th>
            <th scope="col">5</th>
            <th scope="col">6</th>
            <th scope="col">7</th>
            <th scope="col">8</th>
            <th scope="col">9+</th>
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <th scope="row">0</th>
          </tr>
        </tbody>
      </table>
    </div>
    </div>
    <div style="border: 1px solid #666666;padding-left: 1.5em;padding-right: 1.5em;border-radius: 1em;margin-bottom: 1em;">
    <div class="row">
      <div class="col">
        <canvas id="myChart3"></canvas>
      </div>
      <div class="col">
        <!-- <canvas id="myChart5"></canvas> -->
      </div>
    </div>
    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Detalle de Producción</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">2,50</th>
            <th scope="col">3,3 D</th>
            <th scope="col">3,3 G</th>
            <th scope="col">4</th>
            <th scope="col">5</th>
            <th scope="col">6</th>
            <th scope="col">7</th>
            <th scope="col">2,50 Leña</th>
            <th scope="col">2,50 MR</th>
            <th scope="col">Total</th>
            
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>71,4</td>
            <td>345,0</td>
            <td>423,6</td>
            <td>133,4</td>
            <td>66,4</td>
            <td>36,9</td>
            <td>17,0</td>
            <td>201,5</td>
            <td>167,6</td>
            <th scope="row">1.462,7</th>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
    <div style="border: 1px solid #666666;padding-left: 1.5em;padding-right: 1.5em;border-radius: 1em;margin-bottom: 1em;">
    <div class="row">
      <div class="col">
        <canvas id="myChart4"></canvas>
      </div>
      <div class="col">
        <div>
          <h5 style="color:#666666;font-size:16px;text-align:center;">Destinos</h5>
          <canvas style="margin: auto;" width="200" id="myChartD3"></canvas>
        </div>
      </div>
    </div>
    <div class="row">
      <h4 style="font-family:Arial, Helvetica, sans-serif;font-size: 20px;"> Detalle del Total</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">MR</th>
            <th scope="col">2,5</th>
            <th scope="col">3,2</th>
            <th scope="col">4</th>
            <th scope="col">5</th>
            <th scope="col">6</th>
            <th scope="col">7</th>
            <th scope="col">8</th>
            <th scope="col">9+</th>
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>132,93</td>
            <td>0</td>
            <td>495,82</td>
            <td>123,33</td>
            <td>79,83</td>
            <td>34,85</td>
            <td>20,81</td>
            <td>0</td>
            <td>0</td>
            <th scope="row">887,59</th>
          </tr>
        </tbody>
      </table>
    </div>
    </div>
    <hr style="width: 80%;margin-bottom: 2em;">

  </div>


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const ctx = document.getElementById('myChart');
    Chart.defaults.font.size = 16;

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
        datasets: [{
          label: 'Metros Despachados esta Semana',
          data: [0, 0, 0, 0, 0, 0, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        },
        plugins: {
          legend: {
            labels: {
              // This more specific font property overrides the global property
              font: {
                //size: 26
              }
            }
          }
        }
      }
    });
  </script>


  <script>
    const ctx2 = document.getElementById('myChart2');


    new Chart(ctx2, {
      type: 'bar',

      data: {
        labels: ['MR', '2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0+'],
        datasets: [{
          label: 'Metros Despachados este Mes',
          data: [ 0, 0, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 38
            }
          }
        }
      }
    });
  </script>
  <script>
    const ctx5 = document.getElementById('myChart5');

    new Chart(ctx5, {
      type: 'bar',

      data: {
        labels: ['24', '26', '28', '30', '32', '34', '36', '38', '40', '42'],
        datasets: [{
          label: 'Esquema de Trozado 3.3 Grueso',
          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          borderWidth: 1,
          backgroundColor: '#38C22590'
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>

  <script>
    const ctx3 = document.getElementById('myChart3');

    new Chart(ctx3, {
      type: 'bar',

      data: {
        labels: ['2.50', '3.3 D', '3.3 G', '4.0', '5.0', '6.0', '7.0', '2,50 Leña', '2,50 MR'],
        datasets: [{
          label: 'Producción Sotillo',
          data: [71.4, 345.0, 423.6, 133.4, 66.4, 36.9, 17.0, 201.5, 167.6],
          borderWidth: 1,
          backgroundColor: '#F1624490'
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>
  <script>
    const ctx4 = document.getElementById('myChart4');

    new Chart(ctx4, {
      type: 'bar',

      data: {
        labels: ['MR', '2.50', '3.20', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0+'],
        datasets: [{
          label: 'Total Despachos Sotillo',
          data: [132.93, 0, 495.82, 123.33, 79.83, 34.85, 20.81, 0, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            // This more specific font property overrides the global property
            font: {
              size: 28
            }
          }
        }
      }
    });
  </script>

  <script>
    var ctx6 = document.getElementById("myChartD");
    var myChart = new Chart(ctx6, {
      type: 'pie',
      data: {
        labels: [''],
        datasets: [{
          label: 'Metros Despachados',
          data: [1],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(0, 206, 86, 0.2)',
            'rgba(255, 0, 86, 0.2)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(0, 206, 86, 1)',
            'rgba(255, 0, 86, 0.1)',
          ],
          borderWidth: 1
        }]
      },
      
      options: {
        //cutoutPercentage: 40,
        responsive: false,
        

      }
    });
  </script>
  <script>
    var ctx7 = document.getElementById("myChartD2");
    var myChart = new Chart(ctx7, {
      type: 'pie',
      data: {
        labels: ['Novoa', 'F. Cudico'],
        datasets: [{
          label: 'Metros Despachados',
          data: [1,1],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(0, 206, 86, 0.2)',
            'rgba(255, 0, 86, 0.2)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(0, 206, 86, 1)',
            'rgba(255, 0, 86, 0.1)',

          ],
          borderWidth: 1
        }]
      },
      options: {
        plugins:{
          legend: {
            labels: {
              boxWidth: 10,
              boxHeight:10,
              // This more specific font property overrides the global property
              font: {
                size: 12
              }
            }
          },
          tooltip : {

            displayColors : false,
            
            titleFont: {
              size: 1
            },
            bodyFont: {
              size: 12
            },
          }
        },
        //cutoutPercentage: 40,
        responsive: false,

      }
    });
  </script>
  <script>
    var ctx8 = document.getElementById("myChartD3");
    var myChart = new Chart(ctx8, {
      type: 'pie',
      data: {
        labels: ['Novoa','Km10', 'F. Cudico'],
        datasets: [{
          label: 'Metros Despachados',
          data: [35.28, 244.16, 608.14],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(75, 192, 0, 0.2)',
            'rgba(0, 99, 132, 0.5)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 0, 1)',
            'rgba(0, 99, 132, 1)',

          ],
          borderWidth: 1
        }]
      },
      options: {
        plugins:{
          legend: {
            labels: {
              boxWidth: 10,
              boxHeight:10,
              // This more specific font property overrides the global property
              font: {
                size: 12
              }
            }
          },
          tooltip : {

            displayColors : false,
            
            titleFont: {
              size: 1
            },
            bodyFont: {
              size: 12
            },
          }
        },
        //cutoutPercentage: 40,
        responsive: false,

      }
    });
  </script>

<script>
  // Function to fetch and display data from the API

async function fetchData() {
  const apiURL = 'http://controlforestal.pablocanales.info/api/despachos/search?token=dq02SQSq4oruM7SedTgwb4rEB7Bp9QZ4&order_by=fecha_ingreso&order_dir=desc&metros=true&desde=2023-03-01&hasta=2023-17-09';

  try {
    const response = await fetch(apiURL);
    const data = await response.json();
    let arreglox = [];
    let arr_despachos_semana = [];
    var date = new Date();

    if (response.ok) {
      const despachosList = document.getElementById('despachos-list');

      let first_day_of_the_week = new Date(date_today.setDate(date_today.getDate()
        - date_today.getDay()+1 ));
      first_day_of_the_week.setHours(00, 00, 1);
      let last_day_of_the_week = new Date(date_today.setDate(date_today.getDate()
        - date_today.getDay() + 7));
      last_day_of_the_week.setHours(23, 59, 59);


      let metros_lunes = 0;
      let metros_martes = 0;
      let metros_miercoles = 0;
      let metros_jueves = 0;
      let metros_viernes = 0;
      let metros_sabado = 0;
      let metros_domingo = 0;

      let metros_maihue = 0;
      let metros_colpo = 0;
      let metros_km10 = 0;
      let metros_aravena = 0;
      let metros_cherquenco = 0;
      let metros_lumber = 0;

      let iteracion = 0;

      let conttt = 0;
      data.forEach((despacho) => {
       
        arreglox.push(despacho.fecha_ingreso);
        let fecha = new Date(despacho.fecha_ingreso)
        
        if (( fecha >= first_day_of_the_week)&&(fecha <= last_day_of_the_week)){
          
          // console.log(despacho.numero_guia_despacho+' '+despacho.fecha_ingreso.toString().substring(0, 10 )+' '+despacho.destino+' '+despacho.total_metros);
          
          // if (despacho.destino.trim()=='Maihue'){
          //   conttt=conttt+despacho.total_metros;
          //   console.log('CONTT '+conttt)
          //   metros_maihue=metros_maihue+despacho.total_metros;
          //   console.log('MAIHUE');
  
          // }

          arr_despachos_semana.push(despacho);
          switch(fecha.getDay()){
            case 1: metros_lunes=metros_lunes+despacho.total_metros;
            break;
            case 2: metros_martes=metros_martes+despacho.total_metros;
            break;
            case 3: metros_miercoles=metros_miercoles+despacho.total_metros;
            break;
            case 4: metros_jueves=metros_jueves+despacho.total_metros;
            break;
            case 5: metros_viernes=metros_viernes+despacho.total_metros;
            break;
            case 6: metros_sabado=metros_sabado+despacho.total_metros;
            break;
            case 7: metros_domingo=metros_domingo+despacho.total_metros;
            break;
          }

          switch(despacho.destino.trim()){
            case 'Maihue': metros_maihue=metros_maihue+despacho.total_metros;
            break;
            case 'Km10': metros_km10=metros_km10+despacho.total_metros;
            break;
            case 'Colpo': metros_colpo=metros_colpo+despacho.total_metros;
            break;
            case 'Lumber': metros_lumber=metros_lumber+despacho.total_metros;
            break;
            case 'Aravena': metros_aravena=metros_aravena+despacho.total_metros;
            break;
            case 'Cherquenco': metros_cherquenco=metros_cherquenco+despacho.total_metros;
            break;
          }  

          

            // console.log('Lunes: '+metros_lunes);
            // console.log('Martes: '+metros_martes);
            // console.log('Miercoles: '+metros_miercoles);
            // console.log('Jueves: '+metros_jueves);
            // console.log('Viernes: '+metros_viernes);
            // console.log('Sabado: '+metros_sabado);
            // console.log('Domingo: '+metros_domingo);
          // console.log(arr_despachos_semana[iteracion]);
        } 


        /* TABLA DE ULTIMOS DESPACHOS */
        // if (iteracion == 0) {
        //   let myElement1 = document.getElementById("desp_1_1");
        //   myElement1.innerHTML = despacho.numero_guia_despacho;
        //   let myElement2 = document.getElementById("desp_1_2");
        //   myElement2.innerHTML = despacho.numero_guia_sii;
        //   let myElement3 = document.getElementById("desp_1_3");
        //   myElement3.innerHTML = despacho.fecha_ingreso.toString().substring(0, 10 );
        //   let myElement4 = document.getElementById("desp_1_4");
        //   myElement4.innerHTML = despacho.destino;
        //   let myElement5 = document.getElementById("desp_1_5");
        //   myElement5.innerHTML = parseFloat(despacho.total_metros).toFixed(2);
        //   //myElement = document.getElementById("desp_1_2");
        //   //myElement.innerHTML = despacho.numero_guia_sii;
        // }
        // if (iteracion == 1) {
        //   let myElement1 = document.getElementById("desp_2_1");
        //   myElement1.innerHTML = despacho.numero_guia_despacho;
        //   let myElement2 = document.getElementById("desp_2_2");
        //   myElement2.innerHTML = despacho.numero_guia_sii;
        //   let myElement3 = document.getElementById("desp_2_3");
        //   myElement3.innerHTML = despacho.fecha_ingreso.toString().substring(0, 10 );
        //   let myElement4 = document.getElementById("desp_2_4");
        //   myElement4.innerHTML = despacho.destino;
        //   let myElement5 = document.getElementById("desp_2_5");
        //   myElement5.innerHTML = parseFloat(despacho.total_metros).toFixed(2);
        // }
        // if (iteracion == 2) {
        //   let myElement1 = document.getElementById("desp_3_1");
        //   myElement1.innerHTML = despacho.numero_guia_despacho;
        //   let myElement2 = document.getElementById("desp_3_2");
        //   myElement2.innerHTML = despacho.numero_guia_sii;
        //   let myElement3 = document.getElementById("desp_3_3");
        //   myElement3.innerHTML = despacho.fecha_ingreso.toString().substring(0, 10 );
        //   let myElement4 = document.getElementById("desp_3_4");
        //   myElement4.innerHTML = despacho.destino;
        //   let myElement5 = document.getElementById("desp_3_5");
        //   myElement5.innerHTML = parseFloat(despacho.total_metros).toFixed(2);
        // }

        

        iteracion=iteracion+1;
        
     



        //console.log('Metros: ' + despacho.numero_guia_despacho)
        //console.log(`The first date of the week is: ${first_day_of_the_week}`);
        /*else{
          const listItem = document.createElement('li');
          switch(fecha.getDay()){
          case 1: diasemana="Lunes";
          if ((fecha >= first_day_of_the_week)&&(fecha <= last_day_of_the_week)){
            cont_lunes=cont_lunes+despacho.metros_duros;
            //console.log(cont_lunes);
            
          }   
                          
         
          case 3: diasemana="Miercoles"; break;
          case 4: diasemana="Jueves"; break;
          case 5: diasemana="Viernes"; break;
          case 6: diasemana="Sabado"; break;
          case 7: diasemana="Domingo"; break;
        }
         
        
        fecha=fecha.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"});    
        listItem.textContent = `Guía: ${despacho.numero_guia_despacho}, Fecha: ${fecha} Metros: ${despacho.metros_duros}, Rodal: ${despacho.rodal}`;
        despachosList.appendChild(listItem);
            contador_m3=contador_m3 + 1} */
      
          }
      
      )
      
      console.log('Maihue: '+' '+metros_maihue);
      console.log('Km 10: '+' '+metros_km10);
      console.log('Colpo: '+' '+metros_colpo);
      console.log('Aravena: '+' '+metros_aravena);
      console.log('Lumber: '+' '+metros_lumber);
      console.log('Cherquenco: '+' '+metros_cherquenco);
      

      
    } else {
      console.error(`Error: ${response.status} - ${data.message}`);
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

// Call the fetchData function when the page loads
window.addEventListener('load', fetchData);

let date_today = new Date();


console.log(`The current day index of the week is: ${date_today.getDay()}`);


console.log(`The current date of the week is: ${date_today.getDate()}`);




//console.log(`The first date of the week is: ${first_day_of_the_week}`);
//console.log(`The last day of the week is: ${last_day_of_the_week}`);

</script>
  
</body>

</html>